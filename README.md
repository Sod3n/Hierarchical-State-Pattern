# Hierarchical State Pattern Documentation

## Как установить
1. Установите Extenject > 9.2.0
2. Откройте Package Manager
3. Нажмите на плюс в правом верхнем углу
4. Выберете “Add package from git URL…”, вставьте ссылку https://github.com/Sod3n/Hierarchical-State-Pattern.git?path=/Assets/Plugins/HierarchicalStatePattern и нажмите кнопку “add"

## Описание

Данная библиотека основана на паттерне состояний(State Pattern). При этом оно расширяет этот паттерн, дополняя его концепцией компонентов, которой следует Unity.

Эта реализация представляет состояния как игровые объекты(GameObject), что позволяет нам добавлять компоненты на эти самые объекты, тем самым описывая его поведения в этом состоянии.

Для описания смены состояния служат переходы(transitions) и связывают состояние в которое этот переход приведёт и ивент по которому этот переход произойдет. 

- Элементы
    
    ## State
    
    Реализует понятие входа и выхода из состояния. То есть включает объект при входе в состояния и выключает - при выходе. Данный функционал отделён от StateController для его переопределения(например StateReference).  
    
    ## State Reference
    
    Состояние при входе в которое, состояние сразу меняется на указанное.
    
    ## State Controller
    
    Контролирует, чтобы при смене состояния, вызывались все методы - входа и выхода состояния.
    
    ## State Behaviour
    
    Переименовывает методы OnEnable и OnDisable на OnEnter и OnExit. Тем самым он предоставляет более информативные названия методов.
    
    ## Transition Data
    
    Хранит информацию перехода, в виде пары состояния и ивента.
    
    ## Transition
    
    Хранит единственный переход в виде TransitionData.
    
    ## Transition Group
    
    Хранит несколько переходов в виде TransitionList.
    
    ## Transition List
    
    List<TransitionData> - объявлено для собственной отрисовки
    
    ## Transition Manager
    
    Хранит ссылки на объекты переходов(Transition и TransitionGroup), а так же список специфичных для этого состояния переходов. При этом если переходы задаются состоянием на которое наше состоянии изменится и событием при котором это произойдёт, то подписку действия смены события этих переходов реализует данный менеджер. Подписывается и отписывается он при входе и выходе из состоянии и является StateComponent`ом
    
- Вопросы и ответы
    
    ## Зачем всё это нужно?
    
    Данная реализация паттерна состояний служат для решения тех проблем, которые обычно ставят перед ним. А именно - необходимость ограничения функционала объекта в разные моменты игры. Например, мы не хотим, чтобы игрок мог передвигаться во время использования скилла X, а так же чтобы не мог прыгать, а так же чтобы не мог приседать, а так же чтобы не мог использовать другие скиллы… и т.д. и т.п. Более правильным решением данной проблемы будет не ограничение функционала путём условий, но разделения времени игрового объекта на промежутки времени(состояния) и описание функционала объекта в эти промежутки времени. Таким образом мы не ограничиваем функционал объекта, а каждый раз сбрасываем его и описываем по новой. 
    
    ## Как создать объект состояния?
    
    Если есть префаб, достаточно просто использовать его. В ином же случае нужно создать пустой игровой объект и добавить на него компоненты State и TransitionManager.
    
    ## Как добавить переход из состояния A в состояние B при событие C?
    
    - В компоненте TransitionManager объекта состояния A добавить новый элемент в списке Transitions.
    - В поле State перенести компонент(или объект) состояния B
    - В поле Event Reference перенести компонент по событие которого мы хотим переходить в состояние B
    - В появившемся выпадающем списке выберете желаемое событие
    
    ## Как добавить компонент поведения(StateBehaviour) на состояние?
    
    Как обычный Unity Monobehaviour
    
    ## Как создать свой компонент поведения(StateBehaviour)?
    
    Создать новый скрипт и наследовать его от StateBehaviour. Вы можете использовать все функции MonoBehaviour, но при этом переопределять(override) функции OnEnter, которая вызывается когда объект входит в состояние, и OnExit - когда объект выходит из состояния.
    
    ## Зачем нужны ссылаемые переходы?
    
    Переходы события описываемые в TransitionManager обычно ссылаются на компоненты принадлежащие этому состоянию, в то время когда ссылаемые переходы(переходы описываемые в отдельных от TransitionManager`а компонентах, например Transition и TransitionGroup) используют компоненты других объектов, например объекта Input, который описывает события пользовательского ввода. 
    
    ## Как создать ссылаемый переход и добавить его на состояние?
    
    Для этого достаточно добавить на любой объект(но правильным будет добавить на сам объект состояния) компонент перехода(Transition), задать данные перехода, а затем в компоненте TransitionManager объект состояния добавить новый элемент списка References и перетянуть компонент перехода в появившееся поле.
    
    ## Как объединить ссылаемые переходы в одну ссылку и добавить её в состояние?
    
    Для этого достаточно добавить на любой объект(обычно на объект выше по иерархии, который объединяет состояния) компонент группы переходов(TransitionGroup), добавить в список Transitions необходимые ссылки на переходы, а затем в компоненте TranitionManager объект состояния добавить новый элемент списка References и перетянуть компонент группы переходов в появившееся поле.
    
